<!--
  Copyright (C) 2025 356C LLC
  Author: Preston Brown <pbrown@brown-house.net>

  This file is part of HelixScreen.

  HelixScreen is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  HelixScreen is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with HelixScreen. If not, see <https://www.gnu.org/licenses/>.
-->

<component>
	<!-- Print File Card Component - Responsive Flexbox Layout
	     Uses flex_grow with min/max constraints to adapt to any screen size.
	     Container's flex_flow="row_wrap" will automatically fit cards and wrap.
	-->

	<api>
		<prop type="string" name="thumbnail_src"/>
		<prop type="string" name="filename"/>
		<prop type="string" name="print_time"/>
		<prop type="string" name="filament_weight"/>
	</api>

	<consts>
		<!-- Component-specific spacing (not in globals) -->
		<px name="metadata_top_pad" value="4"/>
		<px name="icon_text_gap" value="3"/>

		<!-- Card size constraints for responsive behavior -->
		<px name="card_base_width" value="170"/>
		<px name="card_min_width" value="140"/>
		<px name="card_max_width" value="220"/>
		<px name="card_height" value="245"/>

		<!-- Thumbnail height (overridden by C++ based on card width) -->
		<px name="thumbnail_height" value="150"/>

		<!-- Metadata overlay minimum height -->
		<px name="metadata_overlay_min_height" value="70"/>

		<!-- Filename label height (single line, recalculated in C++ based on font) -->
		<px name="filename_label_height" value="20"/>

		<!-- Metadata label minimum width to prevent crushing -->
		<px name="metadata_label_min_width" value="35"/>
	</consts>

	<view extends="lv_obj"
	      style_flex_basis="#card_base_width"
	      flex_grow="1"
	      style_min_width="#card_min_width"
	      style_max_width="#card_max_width"
	      height="#card_height"
	      style_bg_color="#card_bg"
	      style_radius="#card_radius"
	      style_border_width="0"
	      style_pad_all="0"
	      style_clip_corner="true"
	      clickable="true"
	      scrollable="false"
	      name="card_root">

		<!-- Gradient background (scaled to fill card) -->
		<lv_image src="A:assets/images/thumbnail-gradient-bg.png"
		          width="100%"
		          height="100%"
		          style_bg_opa="0"
		          align="center"
		          name="gradient_background"/>

		<!-- Thumbnail image (scaled in C++ with object-fit:cover to fill card) -->
		<lv_image src="$thumbnail_src"
		          width="100%"
		          height="100%"
		          style_bg_opa="0"
		          align="top_mid"
		          inner_align="top_mid"
		          name="thumbnail"/>

		<!-- Metadata overlay (absolute positioned at bottom with transparency) -->
		<lv_obj width="100%"
		        height="#metadata_overlay_min_height"
		        style_bg_color="#card_bg"
		        style_bg_opa="204"
		        style_border_width="0"
		        style_radius="0"
		        style_pad_left="#gap_tiny"
		        style_pad_right="#gap_tiny"
		        style_pad_top="#gap_tiny"
		        style_pad_bottom="#gap_tiny"
		        align="bottom_mid"
		        flex_flow="column"
		        scrollable="false"
		        name="metadata_overlay">

			<!-- Filename label (single line, truncated with ...) -->
			<lv_label text="$filename"
			          width="100%"
			          height="#filename_label_height"
			          long_mode="dots"
			          style_text_color="#text_primary"
			          style_text_font="montserrat_14"
			          name="filename_label"/>

		<!-- Metadata row (horizontal layout, responsive) -->
		<lv_obj width="100%"
		        style_bg_opa="0"
		        style_border_width="0"
		        style_pad_all="0"
		        style_pad_top="#metadata_top_pad"
		        flex_flow="row"
		        style_pad_gap="#gap_tiny"
		        flex_grow="1"
		        name="metadata_row">

			<!-- Print time (icon + text) -->
			<lv_obj flex_grow="1"
			        height="100%"
			        style_bg_opa="0"
			        style_border_width="0"
			        style_pad_all="0"
			        flex_flow="row"
			        style_pad_gap="#icon_text_gap"
			        style_flex_cross_place="center">
				<icon src="mat_clock"
				      size="xs"
				      variant="accent"/>
				<lv_label text="$print_time"
				          flex_grow="1"
				          style_min_width="#metadata_label_min_width"
				          style_text_color="#text_secondary"
				          style_text_font="montserrat_14"
				          name="time_label"/>
			</lv_obj>

			<!-- Filament weight (icon + text) -->
			<lv_obj flex_grow="1"
			        height="100%"
			        style_bg_opa="0"
			        style_border_width="0"
			        style_pad_all="0"
			        flex_flow="row"
			        style_pad_gap="#icon_text_gap"
			        style_flex_cross_place="center">
				<icon src="mat_layers"
				      size="xs"
				      variant="accent"/>
				<lv_label text="$filament_weight"
				          flex_grow="1"
				          style_min_width="#metadata_label_min_width"
				          style_text_color="#text_secondary"
				          style_text_font="montserrat_14"
				          name="filament_label"/>
			</lv_obj>
		</lv_obj>
		</lv_obj>  <!-- Close metadata_overlay -->
	</view>
</component>
